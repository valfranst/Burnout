<%
  /** Gera avatar SVG placeholder a partir das iniciais do nome */
  function serverDefaultAvatar(name) {
    const initials = (name || '?').split(' ').map(w => w[0]).join('').slice(0, 2).toUpperCase();
    const svg = '<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><rect width="80" height="80" rx="40" fill="%2300d4ff"/><text x="50%25" y="54%25" dominant-baseline="middle" text-anchor="middle" fill="white" font-size="32" font-family="sans-serif">' + initials + '</text></svg>';
    return 'data:image/svg+xml,' + svg;
  }
  const _avatarSrc = user?.picture_url || serverDefaultAvatar(user?.name || user?.email);
%>
<nav class="sidebar" id="sidebar">
  <div class="sidebar-top">
    <a href="/" class="navbar-brand">
      <span class="brand-line">Burnout</span>
    </a>
  </div>
 
  <div id="nav-user" class="sidebar-section <%= user ? '' : 'hidden' %>">
    <div class="user-panel">
      <img id="nav-user-avatar" class="user-avatar lg" src="<%= _avatarSrc %>" alt="avatar"
           onerror="this.onerror=null;this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22><rect width=%2280%22 height=%2280%22 rx=%2240%22 fill=%22%2300d4ff%22/><text x=%2250%25%22 y=%2254%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2232%22 font-family=%22sans-serif%22>?</text></svg>';">
      <div class="user-details">
        <strong id="card-name"><%= user?.name || 'Usuário' %></strong>
        <span id="card-email" class="text-muted"><%= user?.email || '' %></span>
      </div>
      <img id="card-avatar" class="user-avatar hidden" src="<%= _avatarSrc %>" alt="avatar" aria-hidden="true"
           onerror="this.onerror=null;this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22><rect width=%2280%22 height=%2280%22 rx=%2240%22 fill=%22%2300d4ff%22/><text x=%2250%25%22 y=%2254%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22white%22 font-size=%2232%22 font-family=%22sans-serif%22>?</text></svg>';">
      <button id="btn-logout" class="btn btn-outline btn-compact">Sair</button>
    </div>
    <div class="menu-list">
      <a href="/dashboard.html" class="menu-item <%= (body === 'dashboard') ? 'active' : '' %>">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="8" height="8"></rect>
            <rect x="13" y="3" width="8" height="5"></rect>
            <rect x="13" y="10" width="8" height="11"></rect>
            <rect x="3" y="13" width="8" height="8"></rect>
          </svg>
        </span>
        <span class="menu-label">Meu Dashboard</span>
      </a>
      <a href="/metricas_pessoais" class="menu-item <%= (body === 'metricas_pessoais') ? 'active' : '' %>">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z"></path>
            <path d="M14 2v6h6"></path>
            <path d="M9 14h6"></path>
            <path d="M12 11v6"></path>
          </svg>
        </span>
        <span class="menu-label">Registrar</span>
      </a>
      <a href="/report.html" class="menu-item <%= (body === 'report') ? 'active' : '' %>">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="19" x2="20" y2="19"></line>
            <rect x="6" y="11" width="3" height="8"></rect>
            <rect x="11" y="6" width="3" height="13"></rect>
            <rect x="16" y="9" width="3" height="10"></rect>
          </svg>
        </span>
        <span class="menu-label">Relatório Público</span>
      </a>
      <a href="/treinamento" class="menu-item <%= (body === 'treinamento') ? 'active' : '' %>">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
            <path d="M12 6v6l4 2"></path>
          </svg>
        </span>
        <span class="menu-label">Treinamento & Modelo</span>
      </a>
    </div>
  </div>

  <div id="nav-guest" class="sidebar-section <%= user ? 'hidden' : '' %>">
    <div class="menu-list">
      <a href="/report.html" class="menu-item">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" y1="19" x2="20" y2="19"></line>
            <rect x="6" y="11" width="3" height="8"></rect>
            <rect x="11" y="6" width="3" height="13"></rect>
            <rect x="16" y="9" width="3" height="10"></rect>
          </svg>
        </span>
        <span class="menu-label">Relatório Público</span>
      </a>
      <a href="/treinamento" class="menu-item <%= (body === 'treinamento') ? 'active' : '' %>">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z"></path>
            <path d="M12 6v6l4 2"></path>
          </svg>
        </span>
        <span class="menu-label">Treinamento de Modelo</span>
      </a>
      <a href="/login.html" class="menu-item">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
            <polyline points="10 17 15 12 10 7"></polyline>
            <line x1="15" y1="12" x2="3" y2="12"></line>
          </svg>
        </span>
        <span class="menu-label">Entrar</span>
      </a>
      <a href="/register.html" class="menu-item highlight">
        <span class="menu-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="7" r="4"></circle>
            <path d="M5.5 21a7.5 7.5 0 0 1 13 0"></path>
            <line x1="12" y1="10" x2="12" y2="18"></line>
            <line x1="8" y1="14" x2="16" y2="14"></line>
          </svg>
        </span>
        <span class="menu-label">Cadastrar</span>
      </a>
    </div>
  </div>
</nav>
