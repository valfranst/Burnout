
<div class="container section training-container">
  <h1 class="section-title">Treinamento do Modelo</h1>
  <p class="text-muted mb-2">Informe as métricas, escolha a quantidade de registros para treinar e comparar usando o modelo de burnout.
    Os dados informados são normalizados e usados como parâmetro para buscas no banco de dados pelo limite informado por proximidade vetorial para análise.</p>
  <div id="alert-box"></div>

  <div class="training-layout">
    <!-- Left column: result stats + form -->
    <div class="training-col-left">  
      <form id="training-form" class="card">
      <div class="form-group" style="margin-bottom:1rem;">
        <label for="num_records">Quantidade de registros para treinamento do modelo (100-300)</label>
        <input type="number" id="num_records" name="num_records" min="100" max="300" required placeholder="Ex: 200" value="200">
      </div>

      <div class="form-group" style="margin-bottom:1rem;">
        <label for="risk_preset">Preencher com perfil de risco</label>
        <select id="risk_preset" name="risk_preset">
          <option value="">— Selecione um perfil —</option>
          <option value="low">Baixo</option>
          <option value="medium">Moderado</option>
          <option value="high">Elevado</option>
        </select>
      </div>

      <h3 style="margin:1rem 0 .5rem; font-size:.95rem;">Métricas Comportamentais</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="work_hours">Horas Trabalhadas (0-18)</label>
          <input type="number" id="work_hours" name="work_hours" min="0.5" max="18" step="0.5" required placeholder="Ex: 8" value="8">
        </div>
        <div class="form-group">
          <label for="screen_time_hours">Tempo de Uso de Tela</label>
          <input type="number" id="screen_time_hours" name="screen_time_hours" min="0" max="18" step="0.5" required placeholder="Ex: 10" value="8">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="meetings_count">Quantidade de Reuniões (0-16)</label>
          <input type="number" id="meetings_count" name="meetings_count" min="0" max="16" required placeholder="Ex: 4" value="4">
        </div>
        <div class="form-group">
          <label for="app_switches">Troca de Apps (0-10)</label>
          <input type="number" id="app_switches" name="app_switches" min="0" max="10" required placeholder="Ex: 5" value="5">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="breaks_taken">Pausas no Dia (0-20)</label>
          <input type="number" id="breaks_taken" name="breaks_taken" min="0" max="20" required placeholder="Ex: 3" value="3">
        </div>
        <div class="form-group">
          <label for="after_hours_work">Trabalhou Após Expediente?</label>
          <select id="after_hours_work" name="after_hours_work">
            <option value="false">Não</option>
            <option value="true">Sim</option>
          </select>
        </div>
      </div>

      <h3 style="margin:1rem 0 .5rem; font-size:.95rem;">Métricas Psicológicas</h3>

      <div class="form-row">
        <div class="form-group">
          <label for="sleep_hours">Horas de Sono (2-10)</label>
          <input type="number" id="sleep_hours" name="sleep_hours" min="2" max="10" step="0.5" required placeholder="Ex: 7" value="7">
        </div>
        <div class="form-group">
          <label for="fatigue_score">Fadiga (0-10)</label>
          <input type="number" id="fatigue_score" name="fatigue_score" min="0" max="10" step="0.5" required placeholder="Ex: 6" value="6">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="isolation_index">Índice de Isolamento (3-9)
            <button type="button" class="info-icon" id="isolation-info-btn" aria-label="Como preencher o índice de isolamento">i</button>
          </label>
          <input type="number" id="isolation_index" name="isolation_index" min="3" max="9" step="1" required placeholder="Ex: 5" value="5">
        </div>
        <div class="form-group">
          <label for="task_completion">Conclusão de Tarefas (0-100 %)</label>
          <input type="number" id="task_completion" name="task_completion" min="0" max="100" value="80" placeholder="Ex: 80">
        </div>
      </div>

      <div class="form-row" style="margin-top:1rem; gap:.75rem;">
        <button type="submit" data-action="train_and_run" class="btn btn-primary" style="flex:1; justify-content:center;">
          Treinar e Analisar
        </button>
        <button type="submit" data-action="analyze_only" class="btn btn-outline" style="flex:1; justify-content:center;">
          Analisar
        </button>
      </div>
      </form>
    </div><!-- end training-col-left -->

    <!-- Right column: charts -->
    <div class="training-col-right">
      <div id="charts-section">
        <div class="card mb-2">
          <h5 class="section-title-accent" style="margin-bottom:.5rem;">Precisão do Modelo</h5>
          <div class="chart-container chart-sm">
            <canvas id="chart-acc"></canvas>
          </div>
        </div>
        <div class="card">
          <h5 class="section-title-accent" style="margin-bottom:.5rem;">Erro de Treinamento</h5>
          <div class="chart-container chart-sm">
            <canvas id="chart-loss"></canvas>
          </div>
        </div>
      </div>

      <!-- Console de treinamento em tempo real -->
      <div class="card mt-2" id="training-console-card">
        <h5 class="section-title-accent" style="margin-bottom:.5rem;">
          <i class="fas fa-terminal"></i> Console de Treinamento
        </h5>
        <div id="training-progress-bar" style="display:none; margin-bottom:.5rem;">
          <div style="display:flex; justify-content:space-between; font-size:.75rem; color:var(--muted); margin-bottom:2px;">
            <span id="training-progress-label">Época 0/0</span>
            <span id="training-progress-pct">0%</span>
          </div>
          <div style="width:100%; background:rgba(255,255,255,.08); border-radius:4px; height:6px; overflow:hidden;">
            <div id="training-progress-fill" style="width:0%; height:100%; background:var(--primary); border-radius:4px; transition:width .2s;"></div>
          </div>
        </div>
        <div id="training-console" style="background:rgba(0,0,0,.4); border-radius:6px; padding:.75rem; max-height:220px; overflow-y:auto; font-family:'Courier New',monospace; font-size:.72rem; color:#00ffa3; line-height:1.5;">
          <div style="color:var(--muted);">Aguardando treinamento...</div>
        </div>
      </div>
    </div><!-- end training-col-right -->
  </div><!-- end training-layout -->

  <!-- Result + Weights side by side -->
<div class="result-weights-layout">

<!-- Weights form (left side) -->
<div class="weights-card card" id="weights-panel">
  <h4 class="section-title-accent" style="margin-bottom:.75rem; font-size:1rem;"><i class="fas fa-sliders-h"></i> Pesos da Análise Estática</h4>
  <p style="font-size:.75rem; color:var(--muted); margin-bottom:1rem;">Ajuste os pesos e o bias usados na regressão linear ponderada. Valores negativos são fatores protetores.</p>

  <div class="weights-grid">
    <div class="weight-field">
      <label for="w_day_type">Tipo de Dia</label>
      <input type="number" id="w_day_type" step="0.5" value="1.5">
    </div>
    <div class="weight-field">
      <label for="w_work_hours">Horas Trabalhadas</label>
      <input type="number" id="w_work_hours" step="0.5" value="9.0">
    </div>
    <div class="weight-field">
      <label for="w_screen_time">Tempo de Tela</label>
      <input type="number" id="w_screen_time" step="0.5" value="7.5">
    </div>
    <div class="weight-field">
      <label for="w_meetings">Reuniões</label>
      <input type="number" id="w_meetings" step="0.5" value="6.0">
    </div>
    <div class="weight-field">
      <label for="w_breaks">Pausas <span class="weight-tag protector">protetor</span></label>
      <input type="number" id="w_breaks" step="0.5" value="-7.5">
    </div>
    <div class="weight-field">
      <label for="w_after_hours">Hora Extra</label>
      <input type="number" id="w_after_hours" step="0.5" value="3.75">
    </div>
    <div class="weight-field">
      <label for="w_app_switches">Troca de Apps</label>
      <input type="number" id="w_app_switches" step="0.5" value="6.0">
    </div>
    <div class="weight-field">
      <label for="w_sleep">Sono <span class="weight-tag protector">protetor</span></label>
      <input type="number" id="w_sleep" step="0.5" value="-10.5">
    </div>
    <div class="weight-field">
      <label for="w_isolation">Isolamento</label>
      <input type="number" id="w_isolation" step="0.5" value="9.0">
    </div>
    <div class="weight-field">
      <label for="w_task_completion">Conclusão Tarefas <span class="weight-tag protector">protetor</span></label>
      <input type="number" id="w_task_completion" step="0.5" value="-6.0">
    </div>
    <div class="weight-field">
      <label for="w_fatigue">Fadiga <span class="weight-tag dominant">dominante</span></label>
      <input type="number" id="w_fatigue" step="0.5" value="21.0">
    </div>
    <div class="weight-field">
      <label for="w_bias">Bias (baseline)</label>
      <input type="number" id="w_bias" step="1" value="15">
    </div>
  </div>

  <div style="margin-top:1rem; display:flex; gap:.5rem;">
    <button type="button" id="btn-reset-weights" class="btn btn-outline" style="flex:1; justify-content:center; font-size:.8rem;">Restaurar Padrão</button>
  </div>
</div>

<div class="result-card" id="result">
  <div class="header-section">
    <h3><i class="fas fa-brain"></i> Análise de Bem-estar Remoto</h3>
    <span style="font-size: 0.8rem; color: var(--text-muted)">Dataset: Burnout 2026</span>
  </div>

  <div id="training-stats">

    <div class="stats-row">
      <div class="stat-box">
        <div class="label">Total Analisado</div>
        <div class="value" id="r-total">15.420</div>
      </div>
      <div class="stat-box">
        <div class="label">Média de Burnout</div>
        <div class="value" id="r-avg">6.4</div>
      </div>

      <div class="stat-box">
        <div class="label">Risco Elevado</div>
        <div class="value" id="r-risk-elevated">35%</div>
      </div>
    </div>

    <div class="distribution-container">
      <span class="dist-title">Distribuição de Risco (Burnout Score)</span>
      <div class="progress-stack">
        <div class="progress-item" style="width: 20%; background: var(--success);" title="Baixo"></div>
        <div class="progress-item" style="width: 45%; background: var(--warning);" title="Médio"></div>
        <div class="progress-item" style="width: 35%; background: var(--danger);" title="Alto"></div>
      </div>
      <div style="display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--text-muted);">
        <span>Baixo (0-3)</span>
        <span>Moderado (4-7)</span>
        <span>Elevado (8-10)</span>
      </div>
    </div>
  </div> 

  <div id="prediction-section" class="prediction-highlight">
    <h4 style="margin: 0 0 1rem; font-size: 0.9rem; color: var(--text-muted); text-transform: uppercase;">Resultado da Predição Individual</h4>
    
    <div class="prediction-grid">
      <div class="score-gauge">
        <div class="score-circle" id="p-score-circle" style="border-color: var(--danger); color: var(--danger);">
          8.2
        </div>
        <span class="badge-risk risk-high" id="p-risk-label">Risco Crítico</span>
      </div>

      <div class="prediction-details">
        <div style="margin-bottom: 10px;">
          <small style="color: var(--text-muted); display:block;">Arquétipo Identificado:</small>
          <strong id="p-arch-name" style="font-size: 1.1rem; color: var(--text-main);">Isolamento Produtivo</strong>
        </div>
        <p id="p-advice" style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">
          <i class="fas fa-info-circle"></i> O colaborador apresenta alta carga horária com baixo engajamento social. Recomenda-se pausa obrigatória.
        </p>
      </div>
    </div>
  </div>
</div>

</div><!-- end result-weights-layout -->

  
</div>

<div id="isolation-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="iso-modal-title">
  <div id="isolation-modal-overlay" class="modal-overlay"></div>
  <div class="modal-dialog">
    <h3 id="iso-modal-title">Índice de Isolamento</h3>
    <p>Use 3 (baixo isolamento) até 9 (alto isolamento). Esta faixa segue a lógica da UCLA Loneliness Scale: valores maiores indicam mais sensação de solidão ou desconexão. Procure registrar como se sentiu na média do dia.</p>
    <div class="modal-actions">
      <button type="button" class="btn btn-outline" id="iso-modal-close">Entendi</button>
    </div>
  </div>
</div>
